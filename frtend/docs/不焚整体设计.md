# 不焚（The Unburnt）整体设计

更新时间：2026-02-18  
适用范围：`/unburnt` 模块（与 `/onward` 完全独立）

## 1. 产品定位

`不焚`用于保存用户在 ChatGPT App 内产生、再复制到本站的“有意义对话片段”。  
它不是寄语区，不是留言区，不依赖原生会话接入。

核心定义：
- 数据来源：用户手动粘贴文本。
- 内容形态：一轮或多轮对话，结构化保存。
- 隐私机制：默认不公开（private），用户可切换公开（public）。

## 2. 设计原则

- 复制粘贴优先：不依赖角色头自动识别作为前提。
- 用户可控结构化：通过可视化 message 分段手动定义轮次和归属。
- 两阶段编辑：先结构化，再编辑片段元信息。
- 隐私优先：默认 private，公开为显式用户操作。
- 与 `且行` 解耦：入口、数据表、接口、交互全部独立。

## 3. 用户流程总览

1. 用户进入 `不焚`，点击“新建片段”。
2. 阶段 A：粘贴原文并完成结构化 message 分段。
3. 阶段 B：编辑整段片段信息（标题、标签、公开状态等）。
4. 保存后进入“我的不焚”，按公开/不公开展示。
5. 若设为公开，可进入“公开广场”被他人浏览。

## 4. 阶段 A：结构化编辑器

### 4.0 交互设计目标

- 用户可以快速结构化粘贴的 message，删除不想保留的部分，明确每条 message 的归属（`user` / `4o`）。
- 用户可以完成保存，并按需共享（公开/不公开）。

### 4.1 输入与展示

- 用户粘贴整段文本后，系统按换行切分为 `line[1..N]`。
- 行列表为可滚动区域，保留原始顺序。
- 行与行之间渲染“分割边界（switch boundary）”。

### 4.2 分割交互

- 鼠标悬浮在边界上：边界高亮，显示图标和 CTA（如“在此切分”）。
- 点击边界：将“上一个边界（或顶端）到当前边界”固化为一个 message。
- 再次点击同一边界：取消该切分（若不破坏 message 完整性）。

### 4.3 Message 交互

每个 message 支持：
- 折叠/展开。
- 删除（从结构化结果中移除）。
- 归属切换：`user` / `4o`。

交互要求：
- 悬浮 message 时显示图标和 CTA（轻量浮层）。
- 默认归属策略：新 message 默认沿用“与上一条 message 相反角色”，用户可改。
- 至少保留 1 个非空 message 才能进入下一阶段。

### 4.4 阶段完成条件

- 至少存在 1 个非空 message。
- 每个 message 都具有明确归属（`user` 或 `4o`）。
- 点击“完成结构编辑”进入阶段 B。

## 5. 阶段 B：片段级编辑

在结构化完成后，编辑整段片段的元信息：

- 标题（建议必填，支持自动带入第一条 message 首句作为初始值）。
- 标签（可选）。
- 简介/摘要（可选）。
- 公开状态：`private | public`，默认 `private`。

同时提供：
- 卡片预览（列表态）。
- 详情预览（多轮对话态）。
- “返回结构编辑”按钮（不丢失已编辑数据）。

## 6. 页面结构

### 6.1 `/unburnt`

- 我的不焚（仅本人）：
  - 全部
  - 仅公开
  - 仅不公开
- 公开广场（所有访客可见，仅 public）。

### 6.2 `/unburnt/new`

- 新建向导：
  - 阶段 A：结构化编辑
  - 阶段 B：片段级编辑

### 6.3 `/unburnt/:id`

- 片段详情页：
  - 展示结构化 `messages[]`
  - 本人可编辑、删除、切换公开状态
  - 非本人仅在 public 时可访问

## 7. 数据模型（建议）

### 7.1 表：`unburnt_entries`

- `id TEXT PRIMARY KEY`
- `anon_user_id TEXT NOT NULL`
- `title TEXT NOT NULL`
- `summary TEXT NOT NULL DEFAULT ''`
- `raw_text TEXT NOT NULL`
- `messages_json TEXT NOT NULL`  
  结构：`[{ role: "user" | "assistant", content: string, order: number }]`
- `visibility TEXT NOT NULL DEFAULT 'private'`  
  取值：`private | public`
- `tags_json TEXT NOT NULL DEFAULT '[]'`
- `created_at TEXT NOT NULL`
- `updated_at TEXT NOT NULL`
- `deleted_at TEXT`（可选，若需要软删除）

建议索引：
- `(anon_user_id, created_at DESC, id DESC)`
- `(visibility, created_at DESC, id DESC)`

### 7.2 可选表：`unburnt_drafts`

用于保存阶段 A/B 草稿（若需要跨刷新恢复）。

## 8. API 设计（建议）

私有（需 `anon_user_id`）：
- `GET /api/unburnt?scope=mine&visibility=all|public|private&limit=20&cursor=...`
- `POST /api/unburnt`
- `GET /api/unburnt/:id`
- `PATCH /api/unburnt/:id`
- `DELETE /api/unburnt/:id`
- `POST /api/unburnt/:id/visibility`  
  body: `{ "visibility": "private" | "public" }`

公开：
- `GET /api/unburnt/public?limit=20&cursor=...`
- `GET /api/unburnt/public/:id`

## 9. 状态与权限规则

- 新建默认 `private`。
- `private` 仅创建者可见。
- 切换为 `public` 后进入公开广场。
- 从 `public -> private` 时，立即从公开广场下架。
- 非创建者不可修改任何片段。

## 10. 前端实现要点

- 新增 `unburntApiService.ts`，不复用 `onwardApiService.ts`。
- 在 `main.ts` 为 `unburnt` 增加独立交互初始化（当前为静态渲染，需改造）。
- 新增结构化编辑器状态：
  - `lines[]`
  - `boundaries[]`
  - `messages[]`
  - `fragmentMeta`
- 保存时将 `messages[]` 直接写入 `messages_json`。
- 全程保留 `rawText` 以支持重编辑和纠错。

## 11. V1 范围建议

V1 必做：
- 粘贴文本 -> 分割建 message -> 角色切换 -> 片段元信息编辑 -> 保存
- 我的不焚列表
- 公开广场
- 公开/不公开切换

V1 可不做：
- 自动角色识别
- 协作编辑
- 富文本复杂格式（先纯文本/基础 markdown）

---

该方案满足当前前提：用户对话主要发生在 ChatGPT App 内，`不焚`以复制粘贴为主，并通过手动结构化确保结果可控、准确、可公开分享。